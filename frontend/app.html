<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MetaMask Connect (ethers v6)</title>
  <!-- ë¸Œë¼ìš°ì € ì „ì—­ ethers ê°ì²´ ìƒì„± -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>MetaMask ì—°ê²° ë°ëª¨</h2>
  <button id="connectButton">ğŸ”— MetaMask ì—°ê²°</button>
  <p id="accountInfo"></p>

  <h2>ğŸ¦ SimpleBank ìƒí˜¸ì‘ìš©</h2>
  <button id="depositButton">ğŸ’° ì…ê¸ˆ (0.01 ETH)</button><br><br>

  <input type="number" id="withdrawAmt" placeholder="ì¶œê¸ˆí•  ê¸ˆì•¡ (ETH)">
  <button id="withdrawButton">ğŸ§ ì¶œê¸ˆ</button><br><br>

  <button id="checkBalance">ğŸ“Š ë‚´ ì”ì•¡ í™•ì¸</button><br><br>

  <button id="checkEth">ğŸ’  ì§€ê°‘ ETH ì”ì•¡ í™•ì¸</button><br><br>
  <button id="checkMyBalance">ğŸ¦ myBalance() ì¡°íšŒ</button>

  <p id="balanceInfo"></p>
  <p id="myBalanceInfo"></p>

<script type="module">
  const contractAddress = '0x5FbDB2315678afecb367f032d93F642f64180aa3';
  const res = await fetch('./SimpleBank.json');
  const json = await res.json();
  const contractABI = json.abi;

  let provider, signer, contract;

  const connectBtn     = document.getElementById('connectButton');
  const depositBtn     = document.getElementById('depositButton');
  const withdrawBtn    = document.getElementById('withdrawButton');
  const checkBalanceBtn = document.getElementById('checkBalance');

  const accountInfo    = document.getElementById('accountInfo');
  const balanceInfo    = document.getElementById('balanceInfo');

  connectBtn.onclick = async () => {
    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send('eth_requestAccounts', []);
    signer = await provider.getSigner();
    const address = await signer.getAddress();
    contract = new ethers.Contract(contractAddress, contractABI, signer);
    accountInfo.textContent = `âœ… ì—°ê²°ëœ ì£¼ì†Œ: ${address}`;
  };

  depositBtn.onclick = async () => {
    try {
      const tx = await contract.deposit({ value: ethers.parseEther("0.01") });
      await tx.wait();
      alert("ğŸ’° ì…ê¸ˆ ì™„ë£Œ!");
    } catch (err) {
      alert("âŒ ì…ê¸ˆ ì‹¤íŒ¨: " + err.message);
    }
  };

  withdrawBtn.onclick = async () => {
    try {
      const amount = document.getElementById('withdrawAmt').value;
      if (!amount || isNaN(amount) || Number(amount) <= 0) {
        alert("ì¶œê¸ˆí•  ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const tx = await contract.withdraw(ethers.parseEther(amount));
      await tx.wait();
      alert("ğŸ§ ì¶œê¸ˆ ì™„ë£Œ!");
    } catch (err) {
      alert("âŒ ì¶œê¸ˆ ì‹¤íŒ¨: " + err.message);
    }
  };

  checkBalanceBtn.onclick = async () => {
    try {
      const addr = await signer.getAddress();
      const bal = await contract.balanceOf(addr);
      balanceInfo.textContent = `ğŸ“Š í˜„ì¬ ì”ì•¡: ${ethers.formatEther(bal)} ETH`;
    } catch (err) {
      alert("ì”ì•¡ ì¡°íšŒ ì‹¤íŒ¨: " + err.message);
    }
  };

  /* â¶ ì§€ê°‘ ETH ì”ì•¡ í™•ì¸ */
document.getElementById('checkEth').onclick = async () => {
  try {
    const addr = await signer.getAddress();
    const ethBal = await provider.getBalance(addr);           // ë„¤ì´í‹°ë¸Œ ETH
    alert(`ì§€ê°‘ ì£¼ì†Œ ë‚´ ì”ì•¡: ${ethers.formatEther(ethBal)} ETH`);
  } catch (err) {
    alert("ETH ì”ì•¡ ì¡°íšŒ ì‹¤íŒ¨: " + err.message);
  }
};

/* â· myBalance() í˜¸ì¶œ */
document.getElementById('checkMyBalance').onclick = async () => {
  try {
    const bal = await contract.myBalance();                   // view í•¨ìˆ˜
    document.getElementById('myBalanceInfo').textContent =
      `ğŸ¦ ì»¨íŠ¸ë™íŠ¸ ë³´ê´€ ì”ì•¡: ${ethers.formatEther(bal)} ETH`;
  } catch (err) {
    alert("myBalance ì¡°íšŒ ì‹¤íŒ¨: " + err.message);
  }
};
</script>
</body>
</html>
